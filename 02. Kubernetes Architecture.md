# CLASS 2: Kubernetes Architecture

## Overview  
Kubernetes architecture consists of two main planes:

| Plane         | Purpose                                | Components                            |
|---------------|--------------------------------------|-------------------------------------|
| **Control Plane** | Manages and controls the cluster      | kube-api-server, kube-controller-manager, kube-scheduler, etcd, cloud-controller-manager |
| **Data Plane**    | Runs workloads & manages networking  | kube-proxy, kubelet, container runtime (docker/containerd/CRI-O) |

- The **Control Plane** is like the brain of Kubernetes, making decisions and managing the cluster state.
- The **Data Plane** is where the actual containerized workloads run on worker nodes.

***

## Kubernetes Cluster Components  

| Component               | Description                                                                                   | Plane           |
|-------------------------|-----------------------------------------------------------------------------------------------|-----------------|
| **kube-api-server**     | Frontend of the control plane; main entry point to interact with the cluster via REST API (kubectl requests go here). | Control Plane   |
| **kube-controller-manager** | Runs controller processes to regulate cluster state (e.g., manages nodes, replicas, jobs).                 | Control Plane   |
| **kube-scheduler**      | Assigns newly created pods to appropriate nodes based on resource availability and constraints. | Control Plane   |
| **etcd**                | Distributed key-value store; saves cluster state and configuration data persistently.           | Control Plane   |
| **cloud-controller-manager** | Manages cloud-specific control actions (load balancers, volumes, etc.) via cloud APIs.                | Control Plane   |
| **kubelet**             | Agent on each worker node; ensures containers are running and healthy as per desired configurations. | Data Plane      |
| **container runtime**   | Software to run containers on nodes, e.g., containerd, CRI-O, Docker Engine (with cri-dockerd).  | Data Plane      |
| **kube-proxy**          | Network proxy on each node managing routing and load balancing for services (TCP/UDP packets).   | Data Plane      |

***

## Detailed Component Functions

### Control Plane Components
- **kube-api-server**  
  - Serves the Kubernetes API (RESTful interface).  
  - Handles authentication, authorization, and processes all cluster commands.  

- **kube-controller-manager**  
  - Runs controllers such as:  
    - **Node controller:** Manages node status, monitors node failures.  
    - **Replication controller:** Maintains pod replication.  
    - **Job controller:** Manages batch jobs.  

- **kube-scheduler**  
  - Watches for unscheduled pods and assigns them to nodes respecting constraints like resources, affinity, taints, etc.

- **etcd**  
  - Consistent, highly available key-value store for all cluster data (pods, services, configuration).  
  - Master node uses etcd to retrieve cluster state information.

- **cloud-controller-manager**  
  - Integrates with cloud provider APIs for managing cloud resources like load balancers or storage volumes.

### Data Plane Components
- **kubelet**  
  - Runs on every worker node.  
  - Communicates with the API server and manages pod lifecycle on the node.  
  - Ensures containers specified in pod definitions are running and healthy.

- **Container Runtime**  
  - Responsible for running containers.  
  - Pulls container images and manages container lifecycle (start, stop).  
  - Examples: containerd, CRI-O, Docker with cri-dockerd.

- **kube-proxy**  
  - Manages network rules on nodes for service routing.  
  - Enables communication between pods and services via load balancing.

***

## Add-Ons and Other Components

| Component               | Purpose                                                                                             |
|-------------------------|---------------------------------------------------------------------------------------------------|
| **DNS**                 | In-cluster DNS service for service discovery by name across pods.                                 |
| **Dashboard**           | Web-based UI for cluster management and monitoring.                                               |
| **Ingress Controller**  | Manages external HTTP/HTTPS access to cluster services with load balancing and routing.           |
| **Heapster**            | Aggregates cluster metrics for monitoring and performance. (Note: deprecated in newer versions.)  |
| **Cluster Autoscaler**  | Automatically scales the number of worker nodes based on pod resource demands.                     |
| **Network Plugin (CNI)**| Manages pod networking, connectivity between pods across nodes (e.g., Calico, Flannel, Cilium).    |
| **Pod Security Policies**| Defines cluster-wide security policies for pods (privilege escalation, host filesystem access).    |
| **Custom Resource Definitions (CRDs)** | Extends Kubernetes API to create user-defined resources and controllers.                |

***

## Key Principles of Kubernetes Architecture

- **API Driven**: Everything is managed via a RESTful API exposed by the kube-api-server.
- **Declarative Desired State**: Users specify what they want; Kubernetes monitors and works to maintain it.
- **Separation of Concerns**: Control Plane manages the cluster; Data Plane runs application workloads.
- **Highly Distributed and Scalable**: Components can be replicated for high availability and scale.

***

## Summary Table: Control Plane vs Data Plane

| Aspect              | Control Plane                         | Data Plane                           |
|---------------------|-------------------------------------|------------------------------------|
| Purpose             | Manages and controls the cluster    | Runs workloads and pod networking  |
| Location            | Runs on master nodes                 | Runs on worker nodes                |
| Core Components     | kube-api-server, scheduler, controllers, etcd, cloud-controller-manager | kubelet, container runtime, kube-proxy |
| Interactions        | Interfaces with users and APIs       | Interfaces with control plane and pods  |

***



